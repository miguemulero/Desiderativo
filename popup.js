// Plantillas para el Cuestionario Desiderativo
const templates = {
  basic: `# Cuestionario Desiderativo - Plantilla Básica

## Información del Evaluado
- Nombre:
- Edad:
- Fecha de evaluación:
- Evaluador:

## Consignas y Respuestas

### Catexis Positivas
1. **Si no pudiera ser persona, ¿qué es lo que más le gustaría ser?**
   - Respuesta:
   - Justificación:

2. **Si no pudiera ser persona, ¿qué otra cosa le gustaría ser?**
   - Respuesta:
   - Justificación:

3. **¿Qué otra cosa le gustaría ser?**
   - Respuesta:
   - Justificación:

### Catexis Negativas
4. **Si no pudiera ser persona, ¿qué es lo que menos le gustaría ser?**
   - Respuesta:
   - Justificación:

5. **¿Qué otra cosa no le gustaría ser?**
   - Respuesta:
   - Justificación:

6. **¿Qué otra cosa no le gustaría ser?**
   - Respuesta:
   - Justificación:

## Observaciones
- Tiempo de reacción:
- Actitud durante la prueba:
- Comentarios adicionales:
`,

  detailed: `# Cuestionario Desiderativo - Análisis Detallado

## Datos Generales
- Nombre completo:
- Edad:
- Sexo:
- Fecha de evaluación:
- Motivo de consulta:

## Análisis de Respuestas

### Respuestas Positivas (Catexis +)

#### Respuesta 1
- **Símbolo elegido:**
- **Justificación:**
- **Tiempo de latencia:**
- **Reino:** (Animal/Vegetal/Inanimado)
- **Análisis:**
  - Mecanismo de defensa predominante:
  - Cualidades proyectadas:
  - Aspectos de la identidad:

#### Respuesta 2
- **Símbolo elegido:**
- **Justificación:**
- **Tiempo de latencia:**
- **Reino:**
- **Análisis:**
  - Mecanismo de defensa predominante:
  - Cualidades proyectadas:
  - Aspectos de la identidad:

#### Respuesta 3
- **Símbolo elegido:**
- **Justificación:**
- **Tiempo de latencia:**
- **Reino:**
- **Análisis:**
  - Mecanismo de defensa predominante:
  - Cualidades proyectadas:
  - Aspectos de la identidad:

### Respuestas Negativas (Catexis -)

#### Respuesta 4
- **Símbolo rechazado:**
- **Justificación:**
- **Tiempo de latencia:**
- **Reino:**
- **Análisis:**
  - Aspectos rechazados:
  - Mecanismos de defensa:
  - Ansiedades predominantes:

#### Respuesta 5
- **Símbolo rechazado:**
- **Justificación:**
- **Tiempo de latencia:**
- **Reino:**
- **Análisis:**
  - Aspectos rechazados:
  - Mecanismos de defensa:
  - Ansiedades predominantes:

#### Respuesta 6
- **Símbolo rechazado:**
- **Justificación:**
- **Tiempo de latencia:**
- **Reino:**
- **Análisis:**
  - Aspectos rechazados:
  - Mecanismos de defensa:
  - Ansiedades predominantes:

## Síntesis Interpretativa

### Estructura Defensiva
- Defensas predominantes:
- Fortalezas yoicas:
- Vulnerabilidades:

### Aspectos de Identidad
- Autoimagen:
- Ideal del yo:
- Conflictos principales:

### Manejo de Angustias
- Tipo de angustia predominante:
- Recursos adaptativos:

## Conclusiones y Recomendaciones
`,

  interpretation: `# Guía de Interpretación - Cuestionario Desiderativo

## Marco Teórico
El Cuestionario Desiderativo es una técnica proyectiva que permite explorar:
- Mecanismos de defensa
- Estructura de la personalidad
- Aspectos de la identidad
- Fortalezas y vulnerabilidades del yo

## Criterios de Análisis

### 1. Análisis Formal

#### Tiempo de Latencia
- **Normal:** 5-15 segundos
- **Aumentado:** Puede indicar mayor nivel de angustia o conflicto
- **Disminuido:** Puede sugerir respuestas estereotipadas o defensas maníacas

#### Secuencia de Reinos
- **Esperado:** Variedad en los reinos (animal, vegetal, inanimado)
- **Perseveración:** Repetición del mismo reino puede indicar rigidez defensiva
- **Secuencia:** Observar la progresión y cambios

### 2. Análisis de Contenido

#### Catexis Positivas (Lo que le gustaría ser)
Exploran:
- Aspectos idealizados del self
- Fortalezas yoicas
- Mecanismos de defensa adaptativos
- Identificaciones positivas

**Símbolos Frecuentes y Significados:**
- **Aves:** Libertad, trascendencia, deseo de escape
- **Árboles:** Estabilidad, crecimiento, arraigo
- **Agua/Mar:** Fluidez, emociones, inconsciente
- **Sol/Luz:** Vitalidad, conocimiento, idealización
- **Flores:** Belleza, fragilidad, feminidad

#### Catexis Negativas (Lo que no le gustaría ser)
Exploran:
- Aspectos rechazados del self
- Ansiedades predominantes
- Aspectos persecutorios
- Defensas contra lo no deseado

**Símbolos Frecuentes y Significados:**
- **Insectos:** Aspectos despreciados, fragmentación
- **Objetos rotos:** Daño, destrucción
- **Elementos peligrosos:** Temores, agresión
- **Animales agresivos:** Proyección de impulsos

### 3. Mecanismos de Defensa

#### En Catexis Positivas
- **Idealización:** Atributos excesivamente positivos
- **Identificación proyectiva:** Proyección de aspectos valorados
- **Sublimación:** Transformación de impulsos en logros
- **Represión exitosa:** Control adaptativo de impulsos

#### En Catexis Negativas
- **Negación:** Rechazo de aspectos propios
- **Proyección:** Atribución externa de aspectos negativos
- **Formación reactiva:** Énfasis en lo opuesto a impulsos rechazados
- **Aislamiento:** Separación de afecto y contenido

### 4. Indicadores de Fortaleza Yoica

**Respuestas Adaptativas:**
- Variedad de reinos
- Justificaciones elaboradas y coherentes
- Balance entre idealización y realidad
- Capacidad de simbolización
- Flexibilidad defensiva

**Señales de Vulnerabilidad:**
- Perseveración en un reino
- Justificaciones pobres o contradictorias
- Respuestas confusionales
- Negación masiva
- Tiempos de latencia muy prolongados

### 5. Análisis Secuencial

Observar:
- **Primera respuesta (+):** Suele ser la más espontánea, refleja defensa principal
- **Últimas respuestas (+):** Mayor elaboración, defensas secundarias
- **Primera respuesta (-):** Aspectos más temidos o rechazados
- **Secuencia completa:** Progresión y coherencia de las defensas

## Integración Diagnóstica

### Síntesis
1. Identificar mecanismos de defensa predominantes
2. Evaluar fortalezas y vulnerabilidades yoicas
3. Comprender estructura de identidad
4. Detectar conflictos principales
5. Evaluar recursos adaptativos

### Recomendaciones
Integrar los hallazgos con:
- Historia clínica
- Otras técnicas proyectivas
- Entrevistas
- Contexto social y cultural

## Referencias para NotebookLM
Use estas guías como base para:
- Organizar las respuestas del evaluado
- Analizar patrones y tendencias
- Generar hipótesis interpretativas
- Estructurar informes
`
};

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  // Template buttons
  document.getElementById('btn-template-basic').addEventListener('click', () => {
    copyToClipboard(templates.basic, 'Plantilla Básica copiada');
  });

  document.getElementById('btn-template-detailed').addEventListener('click', () => {
    copyToClipboard(templates.detailed, 'Análisis Detallado copiado');
  });

  document.getElementById('btn-template-interpretation').addEventListener('click', () => {
    copyToClipboard(templates.interpretation, 'Guía de Interpretación copiada');
  });

  // Send to NotebookLM button
  document.getElementById('btn-send-to-notebook').addEventListener('click', () => {
    chrome.tabs.create({ url: 'https://notebooklm.google.com' });
  });

  // Resource links (placeholder functionality)
  document.getElementById('link-guide').addEventListener('click', (e) => {
    e.preventDefault();
    showNotification('Próximamente disponible');
  });

  document.getElementById('link-interpretation').addEventListener('click', (e) => {
    e.preventDefault();
    showNotification('Próximamente disponible');
  });

  document.getElementById('link-examples').addEventListener('click', (e) => {
    e.preventDefault();
    showNotification('Próximamente disponible');
  });
});

// Helper function to copy text to clipboard
function copyToClipboard(text, successMessage) {
  navigator.clipboard.writeText(text).then(() => {
    showNotification(successMessage);
    // Also try to send to active NotebookLM tab if open
    sendToNotebookLM(text);
  }).catch(err => {
    console.error('Error al copiar:', err);
    showNotification('Error al copiar el texto');
  });
}

// Helper function to show notifications
function showNotification(message) {
  // Create notification element
  const notification = document.createElement('div');
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #4caf50;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 10000;
    font-size: 14px;
    animation: slideDown 0.3s ease;
  `;
  
  document.body.appendChild(notification);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideUp 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Function to send content to NotebookLM if tab is open
function sendToNotebookLM(text) {
  chrome.tabs.query({ url: 'https://notebooklm.google.com/*' }, (tabs) => {
    if (tabs.length > 0) {
      chrome.tabs.sendMessage(tabs[0].id, {
        action: 'insertText',
        text: text
      }).catch(err => {
        console.log('NotebookLM tab not ready for content injection');
      });
    }
  });
}

// Add CSS animation
const style = document.createElement('style');
style.textContent = `
  @keyframes slideDown {
    from {
      transform: translateX(-50%) translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  }
  
  @keyframes slideUp {
    from {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    to {
      transform: translateX(-50%) translateY(-100%);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);
